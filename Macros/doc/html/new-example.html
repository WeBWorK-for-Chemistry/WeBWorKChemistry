<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>WeBWorKChemistry: new</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">WeBWorKChemistry
   &#160;<span id="projectnumber">0.90</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('new-example.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">new</div>  </div>
</div><!--header-->
<div class="contents">
<p>('1.30') OR new([1.3, 3]) <br  />
<br  />
</p>

<div id='codesection-new' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-new-trigger' src='closed.png' alt='open/close icon' style='display:inline'/> <b>Code:</b>
</div>
<div id='codesection-new-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-new-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><div class="line"><span class="preprocessor"># Number of lines of code in new: 150</span></div>
<div class="line">sub <span class="keyword">new</span> {</div>
<div class="line">    my $self = shift; my $class = ref($self) || $self;</div>
<div class="line">    my $context = (Value::isContext($_[0]) ? shift : $self-&gt;context);</div>
<div class="line">    my $x = shift; $x = [$x,@_] <span class="keywordflow">if</span> scalar(@_) &gt; 0; # not going to worry about <span class="keyword">this</span> scenario yet.</div>
<div class="line">    # <span class="keywordflow">return</span> $x-&gt;inContext($context) <span class="keywordflow">if</span> isInexactValue($x);  # <span class="keywordflow">if</span> it<span class="stringliteral">&#39;s already an inexact value object, return it</span></div>
<div class="line"><span class="stringliteral">    </span></div>
<div class="line"><span class="stringliteral">    # this all seems to deal with turning a single parameter into an array so we can deal with</span></div>
<div class="line"><span class="stringliteral">    # the generic case of passing multiple arguments.  [ ] creates an array reference, so we need</span></div>
<div class="line"><span class="stringliteral">    # arrow operator to dereference before using index.</span></div>
<div class="line"><span class="stringliteral">    $x = [$x] unless ref($x) eq &#39;</span>ARRAY<span class="stringliteral">&#39;;</span></div>
<div class="line"><span class="stringliteral">    # Value::Error(&quot;Can&#39;</span>t convert ARRAY of length %d to %s<span class="stringliteral">&quot;,scalar(@{$x}),Value::showClass($self))</span></div>
<div class="line"><span class="stringliteral">    #   unless (scalar(@{$x}) == 1);</span></div>
<div class="line"><span class="stringliteral">    </span></div>
<div class="line"><span class="stringliteral">    my $argCount = @$x;</span></div>
<div class="line"><span class="stringliteral">    my $sigFigCount = 0;</span></div>
<div class="line"><span class="stringliteral">    my $isScientificNotation = false;</span></div>
<div class="line"><span class="stringliteral">    # Tolerance is useful when asking students to record an inexact value from an analog instrument (i.e. ruler).  The last digit will always vary by a little bit.</span></div>
<div class="line"><span class="stringliteral">    # While a relative value of tolerance is ok, it&#39;s easier to use absolute tolerance since we know approximately how much the last digit will very.</span></div>
<div class="line"><span class="stringliteral">    my $options = {</span></div>
<div class="line"><span class="stringliteral">        tolerance =&gt; 0, </span></div>
<div class="line"><span class="stringliteral">        tolType =&gt; &#39;absolute&#39;,</span></div>
<div class="line"><span class="stringliteral">        scientificNotationThreshold =&gt; 6, # can be set to 20 if problem requires conversion from standard to sci and we need to force standard</span></div>
<div class="line"><span class="stringliteral">    };</span></div>
<div class="line"><span class="stringliteral"></span> </div>
<div class="line"><span class="stringliteral">    #   $tolerance = 0;          # zero tolerance by default</span></div>
<div class="line"><span class="stringliteral">    #   $tolType = &#39;absolute&#39;;   # absolute tolerance if not zero</span></div>
<div class="line"><span class="stringliteral">    </span></div>
<div class="line"><span class="stringliteral">    my $matchNumber = &#39;&#39;;</span></div>
<div class="line"><span class="stringliteral"></span> </div>
<div class="line"><span class="stringliteral">    if ($argCount &gt;= 2) {</span></div>
<div class="line"><span class="stringliteral">        # two arguments mean either a specific number of sig figs is provided or an options hash</span></div>
<div class="line"><span class="stringliteral">        #$isScientificNotation = $x-&gt;[0] =~ /((?:e|e\+|e-|E|E\+|E-|\s?(?:x|\*)\s?10(?:\^|\*\*)-|\s?(?:x|\*)\s?10(?:\^|\*\*)\+|\s?(?:x|\*)\s?10(?:\^|\*\*))\d+)/;</span></div>
<div class="line"><span class="stringliteral">        @result = getValue($x-&gt;[0]);</span></div>
<div class="line"><span class="stringliteral">        $isScientificNotation = $result[1];</span></div>
<div class="line"><span class="stringliteral">        $matchNumber = $result[0]; #$x-&gt;[0];</span></div>
<div class="line"><span class="stringliteral"></span> </div>
<div class="line"><span class="stringliteral">        if (ref $x-&gt;[1] eq ref {}){</span></div>
<div class="line"><span class="stringliteral">            # 2nd arg is an options hash</span></div>
<div class="line"><span class="stringliteral">            $options = {%{$x-&gt;[1]}, %$options};</span></div>
<div class="line"><span class="stringliteral">        } else {</span></div>
<div class="line"><span class="stringliteral">            # check for infinity string first</span></div>
<div class="line"><span class="stringliteral">            if (ref $x-&gt;[1] eq &#39;Value::Infinity&#39;) {</span></div>
<div class="line"><span class="stringliteral">                $sigFigCount = $inf;</span></div>
<div class="line"><span class="stringliteral">            } else {</span></div>
<div class="line"><span class="stringliteral">                $sigFigCount = $x-&gt;[1];</span></div>
<div class="line"><span class="stringliteral">            }</span></div>
<div class="line"><span class="stringliteral">        }</span></div>
<div class="line"><span class="stringliteral"></span> </div>
<div class="line"><span class="stringliteral">        if ($argCount &gt; 2)</span></div>
<div class="line"><span class="stringliteral">        {   </span></div>
<div class="line"><span class="stringliteral">            foreach ( keys%{ $x-&gt;[2] } ){</span></div>
<div class="line"><span class="stringliteral">                $options-&gt;{ $_ } = $x-&gt;[2]-&gt;{ $_ } ; </span></div>
<div class="line"><span class="stringliteral">            }</span></div>
<div class="line"><span class="stringliteral">            </span></div>
<div class="line"><span class="stringliteral">        }</span></div>
<div class="line"><span class="stringliteral"></span> </div>
<div class="line"><span class="stringliteral">        if (exists $options-&gt;{isScientificNotation}){</span></div>
<div class="line"><span class="stringliteral">            $isScientificNotation = $options-&gt;{isScientificNotation};</span></div>
<div class="line"><span class="stringliteral">        }</span></div>
<div class="line"><span class="stringliteral"></span> </div>
<div class="line"><span class="stringliteral">    } else {</span></div>
<div class="line"><span class="stringliteral">        # one argument means that a text value representing the significant figures value has been provided</span></div>
<div class="line"><span class="stringliteral">        @result = getValue($x-&gt;[0]);</span></div>
<div class="line"><span class="stringliteral">        $isScientificNotation = $result[1];</span></div>
<div class="line"><span class="stringliteral">        $matchNumber = $result[0];</span></div>
<div class="line"><span class="stringliteral">        # verify the string contains a number we can match</span></div>
<div class="line"><span class="stringliteral">        #($matchNumber) = $x-&gt;[0] =~ /((?:\+?-?\d+(?:\.\d+)?(?:e|e\+|e-|E|E\+|E-|\s?(?:x|\*)\s?10\^-|\s?(?:x|\*)\s?10\^\+|\s?(?:x|\*)\s?10\^)\d+)|(?:\+?-?\d+(?:\.?\d*)?)|(?:\.\d+))/;</span></div>
<div class="line"><span class="stringliteral">        # added short phrase at beginning to detect plain exponent notation i.e. 10^-5</span></div>
<div class="line"><span class="stringliteral">        #($matchNumber) = $x-&gt;[0] =~ /((?:10\^\+?-?\d+)|(?:\+?-?\d+(?:\.\d+)?(?:e|e\+|e-|E|E\+|E-|\s?(?:x|\*)\s?10\^-|\s?(?:x|\*)\s?10\^\+|\s?(?:x|\*)\s?10\^)\d+)|(?:\+?-?\d+(?:\.?\d*)?)|(?:\.\d+))/;</span></div>
<div class="line"><span class="stringliteral">        #unless (defined $matchNumber) { </span></div>
<div class="line"><span class="stringliteral">        #   $temp = $x-&gt;[0];</span></div>
<div class="line"><span class="stringliteral">        #       Value::Error(&quot;</span>Can<span class="stringliteral">&#39;t convert this to a value. $temp  &quot;);</span></div>
<div class="line"><span class="stringliteral">        #}</span></div>
<div class="line"><span class="stringliteral">        </span></div>
<div class="line"><span class="stringliteral">        # find out if this is standard notation or scientific notation</span></div>
<div class="line"><span class="stringliteral">        # /((?:e|e\+|e-|E|E\+|E-|\s?(?:x|\*)\s?10(?:\^|\*\*)-|\s?(?:x|\*)\s?10(?:\^|\*\*)\+|\s?(?:x|\*)\s?10(?:\^|\*\*))\d+)/;</span></div>
<div class="line"><span class="stringliteral">        # added short phrase at beginning to detect plain exponent notation i.e. 10^-5</span></div>
<div class="line"><span class="stringliteral">        #$isScientificNotation = $x-&gt;[0] =~ /((?:10\^\+?-?\d+)|(?:e|e\+|e-|E|E\+|E-|\s?(?:x|\*)\s?10(?:\^|\*\*)-|\s?(?:x|\*)\s?10(?:\^|\*\*)\+|\s?(?:x|\*)\s?10(?:\^|\*\*))\d+)/;</span></div>
<div class="line"><span class="stringliteral">        </span></div>
<div class="line"><span class="stringliteral">        #($isSimpleExponent, $expVal) = $x-&gt;[0] =~ /((?:^10\^(\+?-?\d+)))/;</span></div>
<div class="line"><span class="stringliteral">        #if ($isSimpleExponent) {</span></div>
<div class="line"><span class="stringliteral">        #   # do the math...</span></div>
<div class="line"><span class="stringliteral">        #   $matchNumber =  10**$expVal;</span></div>
<div class="line"><span class="stringliteral">        #   </span></div>
<div class="line"><span class="stringliteral">        #} </span></div>
<div class="line"><span class="stringliteral"></span> </div>
<div class="line"><span class="stringliteral">        # replace fancier scientific notation with plain &#39;</span>e<span class="stringliteral">&#39; so the computer recognizes it</span></div>
<div class="line"><span class="stringliteral">        #$matchNumber =~ s/\s?(?:x|\*)\s?10(?:\^|\*\*)/e/;</span></div>
<div class="line"><span class="stringliteral">        # split into coefficient and rest is scientific notation </span></div>
<div class="line"><span class="stringliteral">        my @parts = split(/e/, $matchNumber);</span></div>
<div class="line"><span class="stringliteral">        </span></div>
<div class="line"><span class="stringliteral">        # split coefficient into left and right side of decimal point </span></div>
<div class="line"><span class="stringliteral">        # -1 in 3rd parameter is to make unlimited empty matches (show empty trailing part if there is a decimal point even with nothing afterwards)</span></div>
<div class="line"><span class="stringliteral">        my @decimalParts = split(/,|\./, $parts[0], -1); </span></div>
<div class="line"><span class="stringliteral">        $decimalPartsSize = @decimalParts;</span></div>
<div class="line"><span class="stringliteral">        </span></div>
<div class="line"><span class="stringliteral">        # first see if first part is empty string... if so, convert to a zero otherwise next step fails</span></div>
<div class="line"><span class="stringliteral">        if ($decimalParts[0] eq &#39;</span><span class="stringliteral">&#39;){</span></div>
<div class="line"><span class="stringliteral">            $decimalParts[0] = 0;</span></div>
<div class="line"><span class="stringliteral">        }</span></div>
<div class="line"><span class="stringliteral">        # convert first decimalPart to number and see if it is zero</span></div>
<div class="line"><span class="stringliteral">        my $firstPartAsNumber = $decimalParts[0] + 0;</span></div>
<div class="line"><span class="stringliteral">        my $isFirstZero = ($firstPartAsNumber == 0);</span></div>
<div class="line"><span class="stringliteral">            </span></div>
<div class="line"><span class="stringliteral">        if ($decimalPartsSize == 2)</span></div>
<div class="line"><span class="stringliteral">        {</span></div>
<div class="line"><span class="stringliteral">            # has decimal, get no of sig figs in first part, convert to number, then back to string, then get length</span></div>
<div class="line"><span class="stringliteral">            $absFirstPartAsNumber = abs($firstPartAsNumber);</span></div>
<div class="line"><span class="stringliteral">            $sigFigCount = ($isFirstZero ? 0 : length(&quot;$absFirstPartAsNumber&quot;));</span></div>
<div class="line"><span class="stringliteral">            </span></div>
<div class="line"><span class="stringliteral">            # get no of sig figs in second part if not empty (i.e. 25.  decimal point at end)</span></div>
<div class="line"><span class="stringliteral">            unless ($decimalParts[1] eq &quot;&quot;)</span></div>
<div class="line"><span class="stringliteral">            {</span></div>
<div class="line"><span class="stringliteral">                    # if starts with 0, then decimal part might have leading zeros... convert to number, then back to string, then get length</span></div>
<div class="line"><span class="stringliteral">                    # if starts with non-zero, decimal part is all significant... just count digits</span></div>
<div class="line"><span class="stringliteral">                    $secondPartAsNumber = $decimalParts[1] + 0;</span></div>
<div class="line"><span class="stringliteral">                    $sigFigCount += ($isFirstZero ? length(&quot;$secondPartAsNumber&quot;) : length($decimalParts[1]));</span></div>
<div class="line"><span class="stringliteral">            }</span></div>
<div class="line"><span class="stringliteral">        }</span></div>
<div class="line"><span class="stringliteral">        else</span></div>
<div class="line"><span class="stringliteral">        {</span></div>
<div class="line"><span class="stringliteral">             # if decimalPart[0] is a zero, do nothing</span></div>
<div class="line"><span class="stringliteral">            unless ($isFirstZero)</span></div>
<div class="line"><span class="stringliteral">            {</span></div>
<div class="line"><span class="stringliteral">                # use trailing zeros regex</span></div>
<div class="line"><span class="stringliteral">                @matches = ($decimalParts[0] =~ /[1-9]+|0+/g);</span></div>
<div class="line"><span class="stringliteral">                $last = pop @matches;</span></div>
<div class="line"><span class="stringliteral">                if (($last + 0) == 0) #if the last match contains zeros</span></div>
<div class="line"><span class="stringliteral">                {</span></div>
<div class="line"><span class="stringliteral">                    #remove them and count the rest</span></div>
<div class="line"><span class="stringliteral">                    $piece = substr($decimalParts[0], 0, length($decimalParts[0]) - length($last));</span></div>
<div class="line"><span class="stringliteral">                    $sigFigCount = length($piece);</span></div>
<div class="line"><span class="stringliteral">                } else {</span></div>
<div class="line"><span class="stringliteral">                    # just count all the digits</span></div>
<div class="line"><span class="stringliteral">                    $sigFigCount = length($decimalParts[0]);</span></div>
<div class="line"><span class="stringliteral">                }</span></div>
<div class="line"><span class="stringliteral">            } else {</span></div>
<div class="line"><span class="stringliteral">                $sigFigCount = $inf;</span></div>
<div class="line"><span class="stringliteral">            } </span></div>
<div class="line"><span class="stringliteral">        }</span></div>
<div class="line"><span class="stringliteral">    }</span></div>
<div class="line"><span class="stringliteral">    my $s = bless {data =&gt; [$matchNumber], context =&gt; $context}, $class;</span></div>
<div class="line"><span class="stringliteral"></span> </div>
<div class="line"><span class="stringliteral">    $s-&gt;sigFigs($sigFigCount);</span></div>
<div class="line"><span class="stringliteral">    $s-&gt;preferScientificNotation($isScientificNotation);</span></div>
<div class="line"><span class="stringliteral">    $s-&gt;{isInexact} = 1;</span></div>
<div class="line"><span class="stringliteral">    $s-&gt;{precedence}{&#39;</span><a name="_a0"></a><a class="code" href="classInexactValue.html">InexactValue</a><span class="stringliteral">&#39;} = 3;</span></div>
<div class="line"><span class="stringliteral">    $s-&gt;{options} = $options;</span></div>
<div class="line"><span class="stringliteral">    return $s;</span></div>
<div class="line"><span class="stringliteral">}</span></div>
</div><!-- fragment -->
</div>
<div class="fragment"></div><!-- fragment --> </div><!-- contents -->
</div><!-- doc-content -->
<div class="ttc" id="aclassInexactValue_html"><div class="ttname"><a href="classInexactValue.html">InexactValue</a></div><div class="ttdef"><b>Definition:</b> <a href="contextInexactValue_8pl_source.html#l00030">contextInexactValue.pl:30</a></div></div>
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Tue Aug 1 2023 16:59:58 for WeBWorKChemistry by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
