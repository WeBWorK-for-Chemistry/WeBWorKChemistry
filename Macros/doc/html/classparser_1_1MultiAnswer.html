<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>WeBWorKChemistry: parser::MultiAnswer Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">WeBWorKChemistry
   &#160;<span id="projectnumber">0.90</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('classparser_1_1MultiAnswer.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pub-static-attribs">Static Public Attributes</a> &#124;
<a href="classparser_1_1MultiAnswer-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">parser::MultiAnswer Class Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div id="dynsection-0" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-0-trigger" src="closed.png" alt="+"/> Collaboration diagram for parser::MultiAnswer:</div>
<div id="dynsection-0-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-0-content" class="dyncontent" style="display:none;">
<div class="center"><img src="classparser_1_1MultiAnswer__coll__graph.png" border="0" usemap="#parser_1_1MultiAnswer_coll__map" alt="Collaboration graph"/></div>
<map name="parser_1_1MultiAnswer_coll__map" id="parser_1_1MultiAnswer_coll__map">
<area shape="rect" title=" " alt="" coords="5,95,157,121"/>
<area shape="rect" title=" " alt="" coords="35,5,128,32"/>
</map>
<center><span class="legend">[<a target="top" href="graph_legend.html">legend</a>]</span></center></div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:acbd2e6f611d469b7648487d6b5aab1f8"><td class="memItemLeft" align="right" valign="top">public method&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classparser_1_1MultiAnswer.html#acbd2e6f611d469b7648487d6b5aab1f8">asDimensionalAnalysis</a> ()</td></tr>
<tr class="separator:acbd2e6f611d469b7648487d6b5aab1f8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1774b47961b464851f6b397b56a0d254"><td class="memItemLeft" align="right" valign="top">public method&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classparser_1_1MultiAnswer.html#a1774b47961b464851f6b397b56a0d254">asConversionFactor</a> ()</td></tr>
<tr class="separator:a1774b47961b464851f6b397b56a0d254"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3e57d264180550c26a099acf017316d9"><td class="memItemLeft" align="right" valign="top">public method&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classparser_1_1MultiAnswer.html#a3e57d264180550c26a099acf017316d9">asEquality</a> ()</td></tr>
<tr class="separator:a3e57d264180550c26a099acf017316d9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a54b4db68ef616645256c1c1cd006a7cc"><td class="memItemLeft" align="right" valign="top">public method&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classparser_1_1MultiAnswer.html#a54b4db68ef616645256c1c1cd006a7cc">asPairOfConversionFactors</a> ()</td></tr>
<tr class="separator:a54b4db68ef616645256c1c1cd006a7cc"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-static-attribs"></a>
Static Public Attributes</h2></td></tr>
<tr class="memitem:ad1a1d3fabf8deef3a9a61677fe68723b"><td class="memItemLeft" align="right" valign="top"><a id="ad1a1d3fabf8deef3a9a61677fe68723b"></a>
static hash&#160;</td><td class="memItemRight" valign="bottom"><b>known_units</b></td></tr>
<tr class="separator:ad1a1d3fabf8deef3a9a61677fe68723b"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock">
<p class="definition">Definition at line <a class="el" href="parserDimensionalAnalysis_8pl_source.html#l00019">19</a> of file <a class="el" href="parserDimensionalAnalysis_8pl_source.html">parserDimensionalAnalysis.pl</a>.</p>
</div><h2 class="groupheader">Member Function Documentation</h2>
<a id="a1774b47961b464851f6b397b56a0d254"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1774b47961b464851f6b397b56a0d254">&#9670;&nbsp;</a></span>asConversionFactor()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method parser::MultiAnswer::asConversionFactor </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Undocumented Method </p>
<div id='codesection-asConversionFactor' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-asConversionFactor-trigger' src='closed.png' alt='open/close icon' style='display:inline'/> <b>Code:</b>
</div>
<div id='codesection-asConversionFactor-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-asConversionFactor-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><div class="line"><span class="preprocessor"># Number of lines of code in asConversionFactor: 140</span></div>
<div class="line">sub <a class="code" href="classparser_1_1MultiAnswer.html#a1774b47961b464851f6b397b56a0d254">asConversionFactor</a> {</div>
<div class="line">    my $self = shift;</div>
<div class="line">    my $given = shift;</div>
<div class="line">    my $options = shift;    </div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> $self-&gt;with(</div>
<div class="line">        singleResult =&gt; 0,</div>
<div class="line">        allowBlankAnswers=&gt;1,</div>
<div class="line">        checkTypes =&gt; 0,</div>
<div class="line">        checker =&gt; sub {</div>
<div class="line">            my ($correct,$student,$ansHash) = @_;</div>
<div class="line"> </div>
<div class="line">            my @scores = ();</div>
<div class="line"> </div>
<div class="line">            my @correctArray = @{$correct};</div>
<div class="line">            my @studentArray = @{$student};</div>
<div class="line"> </div>
<div class="line">            unless (scalar @correctArray == 2) {</div>
<div class="line">                Value::Error(<span class="stringliteral">&#39;There should only be two answers in this conversion factor.&#39;</span>);</div>
<div class="line">            }</div>
<div class="line"> </div>
<div class="line">            my $studentCalc = $gradeGiven ? @studentArray[0] : $given;</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">for</span> ($i = 0; $i &lt; 2; $i++){</div>
<div class="line">                <span class="keywordflow">if</span> ($studentArray[$i]-&gt;isExactZero){</div>
<div class="line"><span class="preprocessor">                    # handle if zeros in blanks (assume exact 1 for dimensional analysis)</span></div>
<div class="line"><span class="preprocessor">                    # If we don&#39;t do this, we get division by zero errors.  </span></div>
<div class="line"><span class="preprocessor">                    # Plus, intent of blanks in student dimensional analysis is usually 1 mathmatically.</span></div>
<div class="line"><span class="preprocessor">                    # Final answer doesn&#39;t matter.</span></div>
<div class="line">                    $units = $studentArray[$i]-&gt;{units};</div>
<div class="line">                    $newValue = <a class="code" href="classValue.html">Value</a>-&gt;Package(<span class="stringliteral">&quot;InexactValueWithUnits&quot;</span>)-&gt;new([<span class="charliteral">&#39;1&#39;</span>,9**9**9], $units);</div>
<div class="line">                    $studentArray[$i] = $newValue;</div>
<div class="line">                    </div>
<div class="line">                } elsif ($studentArray[$i]-&gt;isOne) {</div>
<div class="line"><span class="preprocessor">                    # for student conversion factors, assume a 1 is exact!</span></div>
<div class="line">                    $units = $studentArray[$i]-&gt;{units};</div>
<div class="line">                    $newValue = <a class="code" href="classValue.html">Value</a>-&gt;Package(<span class="stringliteral">&quot;InexactValueWithUnits&quot;</span>)-&gt;new([<span class="charliteral">&#39;1&#39;</span>,9**9**9], $units);</div>
<div class="line">                    $studentArray[$i] = $newValue;</div>
<div class="line">                }               </div>
<div class="line">            }</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">            # check both values in conversion factors to see if they must be exact or not.          </span></div>
<div class="line">            $numerator = $studentArray[0];</div>
<div class="line">            $denominator = $studentArray[1];</div>
<div class="line"><span class="preprocessor">            # a simple solution would be to look up the units being used and divide their factors... i.e. ft = 0.3048, in = 0.0254</span></div>
<div class="line"><span class="preprocessor">            # so ft/in = 12 exactly</span></div>
<div class="line"><span class="preprocessor">            # now we compare to what the student put.  1 ft / 12 in -&gt; the inverse matches</span></div>
<div class="line"><span class="preprocessor">            # Second example where NOT exact:  L = 0.001  cup = 0.000236588</span></div>
<div class="line"><span class="preprocessor">            # L / cup = 4.22675706291</span></div>
<div class="line"><span class="preprocessor">            # Student might put 1 L / 4.227 cup --- inverse would be 4.227 which is ne to 4.22675706291... so it&#39;s NOT exact</span></div>
<div class="line"><span class="preprocessor">            # Technically, L to cups is never exact.  But if we get precision to this degree, it is probably ok to pretend it is exact.</span></div>
<div class="line"><span class="preprocessor">            # We&#39;re not doing calculations for real-world problems... only education.</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">            # some conversions would have to be manually entered... i.e. lb to g... previous method would require gravity acceleration </span></div>
<div class="line"><span class="preprocessor">            # to be figured into the conversion because they&#39;re technically not the same physical quantities.  Need to compare physical</span></div>
<div class="line"><span class="preprocessor">            # quantities first to see if they could be exact.</span></div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">if</span> (<a class="code" href="classBetterUnits.html#a8f2e082d08b0a8fdd3eba6fb947d3eb1">BetterUnits::comparePhysicalQuantity</a>($numerator-&gt;{units_ref}, $denominator-&gt;{units_ref})){</div>
<div class="line">                </div>
<div class="line">                my $studentInverseRatio = $denominator-&gt;{inexactValue} / $numerator-&gt;{inexactValue};</div>
<div class="line">                my $ratio = $numerator-&gt;{units_ref}-&gt;{factor} / $denominator-&gt;{units_ref}-&gt;{factor};</div>
<div class="line">                $studentInverseRatioAsNumber = $studentInverseRatio-&gt;valueAsNumber();</div>
<div class="line"><span class="preprocessor">                # THIS is really strange, but 1000/1 is not the equal in value to 0.001 / 1e-6 </span></div>
<div class="line"><span class="preprocessor">                # this is equivalent to using the equality 1 L = 1000 mL.</span></div>
<div class="line"><span class="preprocessor">                # To get around this, we covert to string using the &#39;eq&#39; operator.</span></div>
<div class="line">                <span class="keywordflow">if</span> ($ratio eq $studentInverseRatioAsNumber){</div>
<div class="line"><span class="preprocessor">                    # they&#39;re exact!  convert them to values with infinite sig figs</span></div>
<div class="line">                    <span class="keywordflow">if</span> ($numerator-&gt;sigFigs != 9**9**9){</div>
<div class="line">                        $studentArray[0] = <a class="code" href="classInexactValueWithUnits_1_1InexactValueWithUnits.html">InexactValueWithUnits::InexactValueWithUnits</a>-&gt;<a class="code" href="classInexactValueWithUnits_1_1InexactValueWithUnits.html#a171a08d12134b08d4cad73e9221850a2">new</a>([$numerator-&gt;valueAsNumber,9**9**9], $numerator-&gt;{units});</div>
<div class="line">                    }</div>
<div class="line">                    <span class="keywordflow">if</span> ($denominator-&gt;sigFigs != 9**9**9){</div>
<div class="line">                        $studentArray[1] = <a class="code" href="classInexactValueWithUnits_1_1InexactValueWithUnits.html">InexactValueWithUnits::InexactValueWithUnits</a>-&gt;<a class="code" href="classInexactValueWithUnits_1_1InexactValueWithUnits.html#a171a08d12134b08d4cad73e9221850a2">new</a>([$denominator-&gt;valueAsNumber,9**9**9], $denominator-&gt;{units});</div>
<div class="line">                    }</div>
<div class="line">                } </div>
<div class="line">            }</div>
<div class="line">            </div>
<div class="line"><span class="preprocessor">            # Grade equality.  Order does not matter.</span></div>
<div class="line">            my $count=1;</div>
<div class="line">            my $studentGiven;</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">            # What if student supplied inverted conversion factor? i.e. instead of 1 mL / 1e-3 L, they provide 1000 mL / 1 L.</span></div>
<div class="line"><span class="preprocessor">            # We need to make sure the right units are used, BUT instead of comparing individual values, divide numerator and denominator and compare results.</span></div>
<div class="line"><span class="preprocessor">            # Assume 2 values for array.  This is an equality.  Must have both sides filled out.</span></div>
<div class="line">            <span class="keywordflow">if</span> (scalar @studentArray != 2) {</div>
<div class="line">                push @scores, 0;</div>
<div class="line">                push @scores, 0;</div>
<div class="line">                <span class="keywordflow">return</span> \@scores;</div>
<div class="line">            }</div>
<div class="line"> </div>
<div class="line">            $correctRatio = $correctArray[0]-&gt;{inexactValue}/$correctArray[1]-&gt;{inexactValue};</div>
<div class="line">            $studentRatio;</div>
<div class="line">            </div>
<div class="line"><span class="preprocessor">            # Equalities MUST have units.  They are pointless without them.  So only grade if the units are there.</span></div>
<div class="line"><span class="preprocessor">            #if ($studentArray[0]-&gt;{units} eq $correctArray[0]-&gt;{units} &amp;&amp; $studentArray[1]-&gt;{units} eq $correctArray[1]-&gt;{units}) {</span></div>
<div class="line">            <span class="keywordflow">if</span> (<a class="code" href="classInexactValueWithUnits_1_1InexactValueWithUnits.html#ac084cb960b19e412a6e750250cd6016b">InexactValueWithUnits::InexactValueWithUnits::compareUnitHash</a>($studentArray[0]-&gt;{units_ref}, $correctArray[0]-&gt;{units_ref}) == 1</div>
<div class="line">             &amp;&amp; <a class="code" href="classInexactValueWithUnits_1_1InexactValueWithUnits.html#ac084cb960b19e412a6e750250cd6016b">InexactValueWithUnits::InexactValueWithUnits::compareUnitHash</a>($studentArray[1]-&gt;{units_ref}, $correctArray[1]-&gt;{units_ref}) == 1) {</div>
<div class="line">                $studentRatio = $studentArray[0]-&gt;{inexactValue}/$studentArray[1]-&gt;{inexactValue};</div>
<div class="line">                $result = $correctRatio-&gt;compareValue($studentRatio,{<span class="stringliteral">&quot;creditSigFigs&quot;</span>=&gt;0.5, <span class="stringliteral">&quot;creditValue&quot;</span>=&gt;0.5, <span class="stringliteral">&quot;failOnValueWrong&quot;</span>=&gt;1});</div>
<div class="line">                push @scores, $result;</div>
<div class="line">                push @scores, $result;</div>
<div class="line">                <span class="keywordflow">return</span> \@scores;</div>
<div class="line"><span class="preprocessor">            # } </span></div>
<div class="line"><span class="preprocessor"># #         } elsif ($studentArray[1]-&gt;{units} eq $correctArray[0]-&gt;{units} &amp;&amp; $studentArray[0]-&gt;{units} eq $correctArray[1]-&gt;{units}) {</span></div>
<div class="line"><span class="preprocessor">#           elsif (InexactValueWithUnits::InexactValueWithUnits::compareUnitHash($studentArray[1]-&gt;{units_ref}, $correctArray[0]-&gt;{units_ref}) == 1</span></div>
<div class="line"><span class="preprocessor">#            &amp;&amp; InexactValueWithUnits::InexactValueWithUnits::compareUnitHash($studentArray[0]-&gt;{units_ref}, $correctArray[1]-&gt;{units_ref}) == 1) {</span></div>
<div class="line"><span class="preprocessor">#               $studentRatio = $studentArray[1]-&gt;{inexactValue}/$studentArray[0]-&gt;{inexactValue};</span></div>
<div class="line"><span class="preprocessor">#               $result = $correctRatio-&gt;compareValue($studentRatio,{&quot;creditSigFigs&quot;=&gt;0.5, &quot;creditValue&quot;=&gt;0.5, &quot;failOnValueWrong&quot;=&gt;1});</span></div>
<div class="line"><span class="preprocessor">#               push @scores, $result;</span></div>
<div class="line"><span class="preprocessor">#               push @scores, $result;</span></div>
<div class="line"><span class="preprocessor">#               return \@scores;</span></div>
<div class="line"> </div>
<div class="line">            } <span class="keywordflow">else</span> {</div>
<div class="line">                push @scores, 0;</div>
<div class="line">                push @scores, 0;</div>
<div class="line">                $ansHash-&gt;setMessage(1,<span class="stringliteral">&quot;Without correct units, the equality is incorrect.&quot;</span>);</div>
<div class="line">                <span class="keywordflow">return</span> \@scores;</div>
<div class="line">            }</div>
<div class="line">            </div>
<div class="line"><span class="preprocessor">            #$studentValue = shift @studentArray;</span></div>
<div class="line"><span class="preprocessor">            # # check for matching units on both parts, then check for matching value (with tolerance)</span></div>
<div class="line"><span class="preprocessor">            # for ($i = 0; $i &lt; scalar @studentArray; $i++) {</span></div>
<div class="line"><span class="preprocessor">            #   $score = 0;</span></div>
<div class="line"><span class="preprocessor">            #   for ($j = scalar @correctArray - 1; $j &gt;= 0; $j--) {</span></div>
<div class="line"><span class="preprocessor">            #       if ($studentArray[$i]-&gt;{units} eq $correctArray[$j]-&gt;{units}){</span></div>
<div class="line"><span class="preprocessor">            #           my $correctValue = $correctArray[$j];</span></div>
<div class="line"><span class="preprocessor">            #           $score = $correctValue-&gt;{inexactValue}-&gt;compareValue($studentArray[$i]-&gt;{inexactValue},{&quot;creditSigFigs&quot;=&gt;0.5, &quot;creditValue&quot;=&gt;0.5, &quot;failOnValueWrong&quot;=&gt;1});</span></div>
<div class="line"><span class="preprocessor">            #           if ($score != 0 &amp;&amp; $score != 1){</span></div>
<div class="line"><span class="preprocessor">            #               $ansHash-&gt;setMessage($i+1,&quot;Most likely you have a significant figures problem.&quot;);</span></div>
<div class="line"><span class="preprocessor">            #           }</span></div>
<div class="line"><span class="preprocessor">            #           splice(@correctArray, $j, 1);</span></div>
<div class="line"><span class="preprocessor">            #           #delete $correctArray[$j];</span></div>
<div class="line"><span class="preprocessor">            #           last;</span></div>
<div class="line"><span class="preprocessor">            #       } </span></div>
<div class="line"><span class="preprocessor">            #   }</span></div>
<div class="line"><span class="preprocessor">            #   push @scores, $score;</span></div>
<div class="line"><span class="preprocessor">            # }</span></div>
<div class="line">            <span class="keywordflow">return</span> \@scores;</div>
<div class="line">        }</div>
<div class="line">    );</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
 
</div>
</div>
<a id="acbd2e6f611d469b7648487d6b5aab1f8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acbd2e6f611d469b7648487d6b5aab1f8">&#9670;&nbsp;</a></span>asDimensionalAnalysis()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method parser::MultiAnswer::asDimensionalAnalysis </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Undocumented Method </p>
<div id='codesection-asDimensionalAnalysis' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-asDimensionalAnalysis-trigger' src='closed.png' alt='open/close icon' style='display:inline'/> <b>Code:</b>
</div>
<div id='codesection-asDimensionalAnalysis-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-asDimensionalAnalysis-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><div class="line"><span class="preprocessor"># Number of lines of code in asDimensionalAnalysis: 293</span></div>
<div class="line">sub <a class="code" href="classparser_1_1MultiAnswer.html#acbd2e6f611d469b7648487d6b5aab1f8">asDimensionalAnalysis</a> {</div>
<div class="line">    my $self = shift;</div>
<div class="line">    my $given = shift;</div>
<div class="line">    my $options = shift;    </div>
<div class="line">    </div>
<div class="line">    my $gradeGiven = 0;</div>
<div class="line">    <span class="keywordflow">if</span> (exists $options-&gt;{gradeGiven}){</div>
<div class="line">        $gradeGiven = $options-&gt;{gradeGiven};</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> $self-&gt;with(</div>
<div class="line">        singleResult =&gt; 0,</div>
<div class="line">        allowBlankAnswers=&gt;1,</div>
<div class="line">        checkTypes =&gt; 0,</div>
<div class="line">        checker =&gt; sub {</div>
<div class="line">            my ($correct,$student,$ansHash) = @_;</div>
<div class="line"> </div>
<div class="line">            my @scores = ();</div>
<div class="line"> </div>
<div class="line">            my @correctArray = @{$correct};</div>
<div class="line">            my @studentArray = @{$student};</div>
<div class="line"> </div>
<div class="line">            my $studentCalc = $gradeGiven ? @studentArray[0] : $given;</div>
<div class="line"> </div>
<div class="line">            my $factorIndexStart = 0;</div>
<div class="line">            <span class="keywordflow">if</span> ($gradeGiven){</div>
<div class="line">                $factorIndexStart = 1;</div>
<div class="line">            }</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">for</span> ($i = 0; $i &lt; scalar @studentArray - 1; $i++){</div>
<div class="line">                <span class="keywordflow">if</span> ($studentArray[$i]-&gt;isExactZero){</div>
<div class="line"><span class="preprocessor">                    # handle if zeros in blanks (assume exact 1 for dimensional analysis)</span></div>
<div class="line"><span class="preprocessor">                    # If we don&#39;t do this, we get division by zero errors.  </span></div>
<div class="line"><span class="preprocessor">                    # Plus, intent of blanks in student dimensional analysis is usually 1 mathmatically.</span></div>
<div class="line"><span class="preprocessor">                    # Final answer doesn&#39;t matter.</span></div>
<div class="line">                    $units = $studentArray[$i]-&gt;{units};</div>
<div class="line">                    $newValue = <a class="code" href="classValue.html">Value</a>-&gt;Package(<span class="stringliteral">&quot;InexactValueWithUnits&quot;</span>)-&gt;new([<span class="charliteral">&#39;1&#39;</span>,9**9**9], $units);</div>
<div class="line">                    $studentArray[$i] = $newValue;</div>
<div class="line">                    </div>
<div class="line">                } elsif ($studentArray[$i]-&gt;isOne) {</div>
<div class="line"><span class="preprocessor">                    # for student conversion factors, assume a 1 is exact!</span></div>
<div class="line">                    $units = $studentArray[$i]-&gt;{units};</div>
<div class="line">                    $newValue = <a class="code" href="classValue.html">Value</a>-&gt;Package(<span class="stringliteral">&quot;InexactValueWithUnits&quot;</span>)-&gt;new([<span class="charliteral">&#39;1&#39;</span>,9**9**9], $units);</div>
<div class="line">                    $studentArray[$i] = $newValue;</div>
<div class="line">                } </div>
<div class="line">                </div>
<div class="line">            }</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">            # check pairs of values in conversion factors to see if they must be exact or not.</span></div>
<div class="line"><span class="preprocessor">            # adding in &#39;hasChemicals&#39; option:  pairs of mol values will be exact, too.</span></div>
<div class="line"><span class="preprocessor">            # WARNING: a mole value with an energy value will have moles exact, too, but this doesn&#39;t fix that.  </span></div>
<div class="line">            <span class="keywordflow">for</span> ($i = $factorIndexStart; $i &lt; scalar @studentArray - 1; $i+=2) {</div>
<div class="line">                $numerator = $studentArray[$i];</div>
<div class="line">                $denominator = $studentArray[$i+1];</div>
<div class="line"><span class="preprocessor">                # a simple solution would be to look up the units being used and divide their factors... i.e. ft = 0.3048, in = 0.0254</span></div>
<div class="line"><span class="preprocessor">                # so ft/in = 12 exactly</span></div>
<div class="line"><span class="preprocessor">                # now we compare to what the student put.  1 ft / 12 in -&gt; the inverse matches</span></div>
<div class="line"><span class="preprocessor">                # Second example where NOT exact:  L = 0.001  cup = 0.000236588</span></div>
<div class="line"><span class="preprocessor">                # L / cup = 4.22675706291</span></div>
<div class="line"><span class="preprocessor">                # Student might put 1 L / 4.227 cup --- inverse would be 4.227 which is ne to 4.22675706291... so it&#39;s NOT exact</span></div>
<div class="line"><span class="preprocessor">                # Technically, L to cups is never exact.  But if we get precision to this degree, it is probably ok to pretend it is exact.</span></div>
<div class="line"><span class="preprocessor">                # We&#39;re not doing calculations for real-world problems... only education.</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">                # some conversions would have to be manually entered... i.e. lb to g... previous method would require gravity acceleration </span></div>
<div class="line"><span class="preprocessor">                # to be figured into the conversion because they&#39;re technically not the same physical quantities.  Need to compare physical</span></div>
<div class="line"><span class="preprocessor">                # quantities first to see if they could be exact.</span></div>
<div class="line">                <span class="keywordflow">if</span> (<a class="code" href="classBetterUnits.html#a8f2e082d08b0a8fdd3eba6fb947d3eb1">BetterUnits::comparePhysicalQuantity</a>($numerator-&gt;{units_ref}, $denominator-&gt;{units_ref})){</div>
<div class="line">                    my $studentInverseRatio = $denominator-&gt;{inexactValue} / $numerator-&gt;{inexactValue};</div>
<div class="line">                    my $ratio = $numerator-&gt;{units_ref}-&gt;{factor} / $denominator-&gt;{units_ref}-&gt;{factor};</div>
<div class="line">                    my $a = $ratio+0;</div>
<div class="line">                    $a =  main::Round($a,15);</div>
<div class="line">                    my $b = $studentInverseRatio-&gt;valueAsNumber +0;</div>
<div class="line"><span class="preprocessor">                    # comparing as string values to avoid floating point errors in comparison.  </span></div>
<div class="line"><span class="preprocessor">                    # 1000 != 1/0.001 in floating point math even though we know they are equal.</span></div>
<div class="line"><span class="preprocessor">                    # This MAY have an impact on precision tolerances. However, it would be odd to assume</span></div>
<div class="line"><span class="preprocessor">                    # greater than 12 significant figures for educational problems... so maybe moot.</span></div>
<div class="line">                    <span class="keywordflow">if</span> ($ratio eq $studentInverseRatio-&gt;valueAsNumber()){  </div>
<div class="line"><span class="preprocessor">                        # they&#39;re exact!  convert them to values with infinite sig figs</span></div>
<div class="line">                        <span class="keywordflow">if</span> ($numerator-&gt;sigFigs != 9**9**9){</div>
<div class="line">                            $studentArray[$i] = <a class="code" href="classInexactValueWithUnits_1_1InexactValueWithUnits.html">InexactValueWithUnits::InexactValueWithUnits</a>-&gt;<a class="code" href="classInexactValueWithUnits_1_1InexactValueWithUnits.html#a171a08d12134b08d4cad73e9221850a2">new</a>([$numerator-&gt;valueAsNumber,9**9**9], $numerator-&gt;{units});</div>
<div class="line">                        }</div>
<div class="line">                        <span class="keywordflow">if</span> ($denominator-&gt;sigFigs != 9**9**9){</div>
<div class="line">                            $studentArray[$i+1] = <a class="code" href="classInexactValueWithUnits_1_1InexactValueWithUnits.html">InexactValueWithUnits::InexactValueWithUnits</a>-&gt;<a class="code" href="classInexactValueWithUnits_1_1InexactValueWithUnits.html#a171a08d12134b08d4cad73e9221850a2">new</a>([$denominator-&gt;valueAsNumber,9**9**9], $denominator-&gt;{units});</div>
<div class="line">                        }</div>
<div class="line">                    }</div>
<div class="line">                } elsif (<a class="code" href="classBetterUnits.html#a808c970a36170db2739dcf60a2525fcf">BetterUnits::isMolarRatio</a>($numerator-&gt;{units_ref}, $denominator-&gt;{units_ref})) {</div>
<div class="line">                    <span class="keywordflow">if</span> ($numerator-&gt;sigFigs != 9**9**9){</div>
<div class="line">                        $studentArray[$i] = <a class="code" href="classInexactValueWithUnits_1_1InexactValueWithUnits.html">InexactValueWithUnits::InexactValueWithUnits</a>-&gt;<a class="code" href="classInexactValueWithUnits_1_1InexactValueWithUnits.html#a171a08d12134b08d4cad73e9221850a2">new</a>([$numerator-&gt;valueAsNumber,9**9**9], $numerator-&gt;{units});</div>
<div class="line">                    }</div>
<div class="line">                    <span class="keywordflow">if</span> ($denominator-&gt;sigFigs != 9**9**9){</div>
<div class="line">                        $studentArray[$i+1] = <a class="code" href="classInexactValueWithUnits_1_1InexactValueWithUnits.html">InexactValueWithUnits::InexactValueWithUnits</a>-&gt;<a class="code" href="classInexactValueWithUnits_1_1InexactValueWithUnits.html#a171a08d12134b08d4cad73e9221850a2">new</a>([$denominator-&gt;valueAsNumber,9**9**9], $denominator-&gt;{units});</div>
<div class="line">                    }</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">            # warn $studentCalc;</span></div>
<div class="line"><span class="preprocessor">            # calculate answer using student dimensional analysis finally</span></div>
<div class="line">            <span class="keywordflow">for</span> ($i = $factorIndexStart; $i &lt; scalar @studentArray - 1; $i++){</div>
<div class="line"><span class="preprocessor">                # warn $studentArray[$i];</span></div>
<div class="line">                <span class="keywordflow">if</span> ($i % 2 == $factorIndexStart){</div>
<div class="line"><span class="preprocessor">                    # numerator, so multiply</span></div>
<div class="line">                    $studentCalc *= $studentArray[$i];</div>
<div class="line">                } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="preprocessor">                    # denominator, so divide</span></div>
<div class="line">                    $studentCalc /= $studentArray[$i];</div>
<div class="line">                }</div>
<div class="line"><span class="preprocessor">                # warn $studentCalc;</span></div>
<div class="line"><span class="preprocessor">                # warn &#39;next&#39;;</span></div>
<div class="line">            }</div>
<div class="line">            </div>
<div class="line"> </div>
<div class="line">            $ansHash-&gt;setMessage(scalar @studentArray,<span class="stringliteral">&quot;Your dimensional analysis returns this value: $studentCalc&quot;</span>);</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">            # Time to grade dimensional analysis!</span></div>
<div class="line"><span class="preprocessor">            # Grading assumes that the answer provided includes the REQURIED pathway for dimensional analysis.  While order will not matter,</span></div>
<div class="line"><span class="preprocessor">            # the specific conversions do.  i.e. if cm -&gt; m -&gt; um is provided in the answer and the student gives a correct cm-&gt;um direct </span></div>
<div class="line"><span class="preprocessor">            # conversion, then the student will be marked wrong on the conversion work.</span></div>
<div class="line">            my $count=1;</div>
<div class="line">            my $studentGiven;</div>
<div class="line">            </div>
<div class="line">            <span class="keywordflow">if</span> ($gradeGiven) {</div>
<div class="line"><span class="preprocessor">                # We actually have to grade the given value of the problem.  Make sure </span></div>
<div class="line"><span class="preprocessor">                # students are entering dimensional analysis properly from scratch.</span></div>
<div class="line">                $studentGiven = shift @studentArray;</div>
<div class="line"><span class="preprocessor">                # check for matching units on student given and actual given,</span></div>
<div class="line"><span class="preprocessor">                # then check for matching value (with tolerance)</span></div>
<div class="line">                $givenScore=0;</div>
<div class="line">                $message=<span class="stringliteral">&#39;&#39;</span>;</div>
<div class="line">                $valueGrade = $given-&gt;{inexactValue}-&gt;compareValue($studentGiven-&gt;{inexactValue},{<span class="stringliteral">&quot;creditSigFigs&quot;</span>=&gt;0.5, <span class="stringliteral">&quot;creditValue&quot;</span>=&gt;0.5, <span class="stringliteral">&quot;failOnValueWrong&quot;</span>=&gt;1});</div>
<div class="line">                $givenScore = $valueGrade;</div>
<div class="line">                <span class="keywordflow">if</span> ($givenScore != 0 &amp;&amp; $givenScore != 1){</div>
<div class="line">                    $message .= <span class="stringliteral">&quot;Most likely you have a significant figures problem.&quot;</span>;</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">if</span> (<a class="code" href="classInexactValueWithUnits_1_1InexactValueWithUnits.html#ac084cb960b19e412a6e750250cd6016b">InexactValueWithUnits::InexactValueWithUnits::compareUnitHash</a>($given-&gt;{units_ref}, $studentGiven-&gt;{units_ref}) == 0) {</div>
<div class="line"><span class="preprocessor">                #if ($given-&gt;{units} ne $studentGiven-&gt;{units}) {</span></div>
<div class="line">                    $givenScore*=0.5;  # half-credit b/c missing units.</div>
<div class="line">                    $message .= <span class="stringliteral">&quot;Your units are incorrect.&quot;</span>;    </div>
<div class="line">                }               </div>
<div class="line">                push @scores, $givenScore;</div>
<div class="line">                $ansHash-&gt;setMessage($count, $message);</div>
<div class="line">                $count++;</div>
<div class="line"> </div>
<div class="line">                shift @correctArray; # <span class="keywordflow">throw</span> away the first value, don<span class="stringliteral">&#39;t need it anymore</span></div>
<div class="line"><span class="stringliteral">            } </span></div>
<div class="line"><span class="stringliteral"></span> </div>
<div class="line"><span class="stringliteral">            # Remove the answer from the correct array and student array</span></div>
<div class="line"><span class="stringliteral">            $correctAnswer = pop @correctArray;</span></div>
<div class="line"><span class="stringliteral">            $studentAnswer = pop @studentArray;</span></div>
<div class="line"><span class="stringliteral">            while (scalar @studentArray &gt; 1) {</span></div>
<div class="line"><span class="stringliteral"></span> </div>
<div class="line"><span class="stringliteral">                $numerator = shift @studentArray;</span></div>
<div class="line"><span class="stringliteral">                $denominator = shift @studentArray;</span></div>
<div class="line"><span class="stringliteral">                $numeratorScore=0;</span></div>
<div class="line"><span class="stringliteral">                $denominatorScore=0;</span></div>
<div class="line"><span class="stringliteral">                $studentRatio = $numerator-&gt;{inexactValue} / $denominator-&gt;{inexactValue};  </span></div>
<div class="line"><span class="stringliteral"></span> </div>
<div class="line"><span class="stringliteral">                # going to compare simplified units via division of factors</span></div>
<div class="line"><span class="stringliteral">                $studentDiv = $numerator/$denominator;</span></div>
<div class="line"><span class="stringliteral"></span> </div>
<div class="line"><span class="stringliteral">                for ($j = scalar @correctArray - 2; $j &gt;= 0; $j-=2) { </span></div>
<div class="line"><span class="stringliteral">                    # simplify conversion factors first</span></div>
<div class="line"><span class="stringliteral">                    #warn %{$numerator-&gt;{units_ref}};</span></div>
<div class="line"><span class="stringliteral">                    #warn %{$denominator-&gt;{units_ref}};</span></div>
<div class="line"><span class="stringliteral">                    #BetterUnits::simplifyConversionFactorUnits($numerator-&gt;{units_ref},$denominator-&gt;{units_ref});</span></div>
<div class="line"><span class="stringliteral"></span> </div>
<div class="line"><span class="stringliteral">                    # for comparing simplified units</span></div>
<div class="line"><span class="stringliteral">                    $answerDiv = $correctArray[$j] / $correctArray[$j+1];</span></div>
<div class="line"><span class="stringliteral">                    # check for matching units on both parts, then check for matching value (with tolerance)</span></div>
<div class="line"><span class="stringliteral">                    #if (BetterUnits::compareUnitRefs($correctArray[$j]-&gt;{units_ref},$numerator-&gt;{units_ref}) &amp;&amp; BetterUnits::compareUnitRefs($correctArray[$j+1]-&gt;{units_ref},$denominator-&gt;{units_ref})){</span></div>
<div class="line"><span class="stringliteral">                    if (BetterUnits::compareUnitRefs($answerDiv-&gt;{units_ref},$studentDiv-&gt;{units_ref})) {</span></div>
<div class="line"><span class="stringliteral">                        # if answer is an exact number (like 12 inches in 1 ft), student&#39;</span>s input of 12 will automatically be inexact, so just tolerate sig fig <span class="stringliteral">&quot;errors&quot;</span> <span class="keywordflow">if</span> answer is exact</div>
<div class="line">                        </div>
<div class="line">                        $numeratorCreditSigFigs = 0.5;</div>
<div class="line">                        $numeratorCreditValue = 0.5;</div>
<div class="line">                        <span class="keywordflow">if</span> ($correctArray[$j]-&gt;{inexactValue}-&gt;sigFigs() == Inf){</div>
<div class="line">                            $numeratorCreditSigFigs = 0;</div>
<div class="line">                            $numeratorCreditValue = 1.0;</div>
<div class="line">                        }</div>
<div class="line"><span class="preprocessor">                        #warn $numerator-&gt;{inexactValue}-&gt;sigFigs();</span></div>
<div class="line"><span class="preprocessor">                        #warn $correctArray[$j]-&gt;{inexactValue}-&gt;sigFigs();</span></div>
<div class="line"><span class="preprocessor">                        # warn $correctArray[$j]-&gt;{inexactValue};</span></div>
<div class="line"><span class="preprocessor">                        # warn $numerator-&gt;{inexactValue};</span></div>
<div class="line">                        $valueGradeNumerator = $correctArray[$j]-&gt;{inexactValue}-&gt;compareValue($numerator-&gt;{inexactValue},{<span class="stringliteral">&quot;creditSigFigs&quot;</span>=&gt;$numeratorCreditSigFigs, <span class="stringliteral">&quot;creditValue&quot;</span>=&gt;$numeratorCreditValue, <span class="stringliteral">&quot;failOnValueWrong&quot;</span>=&gt;1});</div>
<div class="line">                        $numeratorScore = $valueGradeNumerator;</div>
<div class="line">                        <span class="keywordflow">if</span> ($numeratorScore != 0 &amp;&amp; $numeratorScore != 1){</div>
<div class="line">                            $ansHash-&gt;setMessage($count,<span class="stringliteral">&quot;Most likely you have a significant figures problem.&quot;</span>);</div>
<div class="line">                        }</div>
<div class="line">                        $denominatorCreditSigFigs = 0.5;</div>
<div class="line">                        $denominatorCreditValue = 0.5;</div>
<div class="line">                        <span class="keywordflow">if</span> ($correctArray[$j+1]-&gt;{inexactValue}-&gt;sigFigs() == Inf){</div>
<div class="line">                            $denominatorCreditSigFigs = 0;</div>
<div class="line">                            $denominatorCreditValue = 1.0;</div>
<div class="line">                        }</div>
<div class="line">                        $valueGradeDenominator = $correctArray[$j+1]-&gt;{inexactValue}-&gt;compareValue($denominator-&gt;{inexactValue},{<span class="stringliteral">&quot;creditSigFigs&quot;</span>=&gt;$denominatorCreditSigFigs, <span class="stringliteral">&quot;creditValue&quot;</span>=&gt;$denominatorCreditValue, <span class="stringliteral">&quot;failOnValueWrong&quot;</span>=&gt;1});</div>
<div class="line">                        $denominatorScore = $valueGradeDenominator;</div>
<div class="line">                        <span class="keywordflow">if</span> ($denominatorScore != 0 &amp;&amp; $denominatorScore != 1){</div>
<div class="line">                            $ansHash-&gt;setMessage($count+1,<span class="stringliteral">&quot;Most likely you have a significant figures problem.&quot;</span>);</div>
<div class="line">                        }</div>
<div class="line">                        <span class="keywordflow">if</span> ($numeratorScore == 0 &amp;&amp; $denominatorScore == 0) {</div>
<div class="line"><span class="preprocessor">                            # check the ratio to see if those match.  Maybe student used a different equality like 1L/1000mL instead of 0.001L/1mL</span></div>
<div class="line">                            $correctRatio = $correctArray[$j]-&gt;{inexactValue}/$correctArray[$j+1]-&gt;{inexactValue}; </div>
<div class="line">                            $numeratorScore = $correctRatio-&gt;compareValue($studentRatio,{<span class="stringliteral">&quot;creditSigFigs&quot;</span>=&gt;$numeratorCreditSigFigs, <span class="stringliteral">&quot;creditValue&quot;</span>=&gt;$numeratorCreditValue, <span class="stringliteral">&quot;failOnValueWrong&quot;</span>=&gt;1});</div>
<div class="line">                            $denominatorScore = $correctRatio-&gt;compareValue($studentRatio,{<span class="stringliteral">&quot;creditSigFigs&quot;</span>=&gt;$denominatorCreditSigFigs, <span class="stringliteral">&quot;creditValue&quot;</span>=&gt;$denominatorCreditValue, <span class="stringliteral">&quot;failOnValueWrong&quot;</span>=&gt;1});</div>
<div class="line"> </div>
<div class="line">                        }</div>
<div class="line">    </div>
<div class="line">                        splice(@correctArray, $j, 2);</div>
<div class="line">                        last;</div>
<div class="line">                    } </div>
<div class="line">                }</div>
<div class="line">                push @scores, $numeratorScore;</div>
<div class="line">                push @scores, $denominatorScore;</div>
<div class="line">                $count++;</div>
<div class="line">                $count++;</div>
<div class="line">            }</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">            # reload correctArray with the full array since we&#39;ve been removing stuff.</span></div>
<div class="line">            my @correctArray = @{$correct};</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">            # compute a potential answer with rounding errors from the correct dimensional analysis</span></div>
<div class="line"><span class="preprocessor">            # This might have problems, but right now, we recalculate the answer by reducing the number</span></div>
<div class="line"><span class="preprocessor">            # of sig figs for each factor by 1 (assuming there&#39;s more than 1 already).</span></div>
<div class="line"><span class="preprocessor">            # This is done twice, so we get an imprecise calculation at the end.  This is used</span></div>
<div class="line"><span class="preprocessor">            # to see if maybe the student got it right, but just had rounding errors.</span></div>
<div class="line"><span class="preprocessor">            # We need more tests to see if edge cases will break this estimation.</span></div>
<div class="line">            my @possibleRoundingErrorAnswers = ();</div>
<div class="line">            my $roundingErrorAnswer = $given;</div>
<div class="line">            <span class="keywordflow">for</span> ($i = $factorIndexStart; $i &lt; scalar @correctArray - 1; $i+=2){</div>
<div class="line">                my $numerator = $correctArray[$i];</div>
<div class="line">                my $denominator = $correctArray[$i+1];</div>
<div class="line">                <span class="keywordflow">if</span> ($numerator-&gt;{inexactValue}-&gt;sigFigs &gt; 1 &amp;&amp; $numerator-&gt;{inexactValue}-&gt;sigFigs != 9**9**9) {</div>
<div class="line"><span class="preprocessor">                    # We&#39;re making a copy of the numerator, THEN editing the sig figs, THEN making a new numerator using the rounded value with new sig figs.</span></div>
<div class="line">                    $numerator = <a class="code" href="classInexactValueWithUnits_1_1InexactValueWithUnits.html">InexactValueWithUnits::InexactValueWithUnits</a>-&gt;<a class="code" href="classInexactValueWithUnits_1_1InexactValueWithUnits.html#a171a08d12134b08d4cad73e9221850a2">new</a>($numerator-&gt;{inexactValue}-&gt;valueAsRoundedNumber, $numerator-&gt;{units});</div>
<div class="line">                    $numerator-&gt;{inexactValue}-&gt;sigFigs($numerator-&gt;{inexactValue}-&gt;sigFigs() - 1);</div>
<div class="line">                    $numerator = <a class="code" href="classInexactValueWithUnits_1_1InexactValueWithUnits.html">InexactValueWithUnits::InexactValueWithUnits</a>-&gt;<a class="code" href="classInexactValueWithUnits_1_1InexactValueWithUnits.html#a171a08d12134b08d4cad73e9221850a2">new</a>($numerator-&gt;{inexactValue}-&gt;valueAsRoundedNumber, $numerator-&gt;{units});</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">if</span> ($denominator-&gt;{inexactValue}-&gt;sigFigs &gt; 1 &amp;&amp; $denominator-&gt;{inexactValue}-&gt;sigFigs != 9**9**9) {</div>
<div class="line">                    $denominator = <a class="code" href="classInexactValueWithUnits_1_1InexactValueWithUnits.html">InexactValueWithUnits::InexactValueWithUnits</a>-&gt;<a class="code" href="classInexactValueWithUnits_1_1InexactValueWithUnits.html#a171a08d12134b08d4cad73e9221850a2">new</a>($denominator-&gt;{inexactValue}-&gt;valueAsRoundedNumber, $denominator-&gt;{units});</div>
<div class="line">                    $denominator-&gt;{inexactValue}-&gt;sigFigs($denominator-&gt;{inexactValue}-&gt;sigFigs() - 1);</div>
<div class="line">                    $denominator = <a class="code" href="classInexactValueWithUnits_1_1InexactValueWithUnits.html">InexactValueWithUnits::InexactValueWithUnits</a>-&gt;<a class="code" href="classInexactValueWithUnits_1_1InexactValueWithUnits.html#a171a08d12134b08d4cad73e9221850a2">new</a>($denominator-&gt;{inexactValue}-&gt;valueAsRoundedNumber, $denominator-&gt;{units});</div>
<div class="line">                }</div>
<div class="line">                $roundingErrorAnswer *= $numerator;</div>
<div class="line">                $roundingErrorAnswer /= $denominator;</div>
<div class="line">            }</div>
<div class="line">            push @possibleRoundingErrorAnswers, $roundingErrorAnswer;</div>
<div class="line"> </div>
<div class="line">            my $roundingErrorAnswer = $given;</div>
<div class="line">            <span class="keywordflow">for</span> ($i = $factorIndexStart; $i &lt; scalar @correctArray - 1; $i+=2) {</div>
<div class="line">                my $numerator = $correctArray[$i]-&gt;copy;</div>
<div class="line">                my $denominator = $correctArray[$i+1]-&gt;copy;</div>
<div class="line">                <span class="keywordflow">if</span> ($numerator-&gt;{inexactValue}-&gt;sigFigs &gt; 1 &amp;&amp; $numerator-&gt;{inexactValue}-&gt;sigFigs != 9**9**9) {</div>
<div class="line"><span class="preprocessor">                    # We&#39;re making a copy of the numerator, THEN editing the sig figs, THEN making a new numerator using the rounded value with new sig figs.</span></div>
<div class="line">                    $numerator = <a class="code" href="classInexactValueWithUnits_1_1InexactValueWithUnits.html">InexactValueWithUnits::InexactValueWithUnits</a>-&gt;<a class="code" href="classInexactValueWithUnits_1_1InexactValueWithUnits.html#a171a08d12134b08d4cad73e9221850a2">new</a>($numerator-&gt;{inexactValue}-&gt;valueAsRoundedNumber, $numerator-&gt;{units});</div>
<div class="line">                    $numerator-&gt;{inexactValue}-&gt;sigFigs($numerator-&gt;{inexactValue}-&gt;sigFigs() - 1);</div>
<div class="line">                    $numerator = <a class="code" href="classInexactValueWithUnits_1_1InexactValueWithUnits.html">InexactValueWithUnits::InexactValueWithUnits</a>-&gt;<a class="code" href="classInexactValueWithUnits_1_1InexactValueWithUnits.html#a171a08d12134b08d4cad73e9221850a2">new</a>($numerator-&gt;{inexactValue}-&gt;valueAsRoundedNumber, $numerator-&gt;{units});</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">if</span> ($denominator-&gt;{inexactValue}-&gt;sigFigs &gt; 1 &amp;&amp; $denominator-&gt;{inexactValue}-&gt;sigFigs != 9**9**9) {</div>
<div class="line">                    $denominator = <a class="code" href="classInexactValueWithUnits_1_1InexactValueWithUnits.html">InexactValueWithUnits::InexactValueWithUnits</a>-&gt;<a class="code" href="classInexactValueWithUnits_1_1InexactValueWithUnits.html#a171a08d12134b08d4cad73e9221850a2">new</a>($denominator-&gt;{inexactValue}-&gt;valueAsRoundedNumber, $denominator-&gt;{units});</div>
<div class="line">                    $denominator-&gt;{inexactValue}-&gt;sigFigs($denominator-&gt;{inexactValue}-&gt;sigFigs() - 1);</div>
<div class="line">                    $denominator = <a class="code" href="classInexactValueWithUnits_1_1InexactValueWithUnits.html">InexactValueWithUnits::InexactValueWithUnits</a>-&gt;<a class="code" href="classInexactValueWithUnits_1_1InexactValueWithUnits.html#a171a08d12134b08d4cad73e9221850a2">new</a>($denominator-&gt;{inexactValue}-&gt;valueAsRoundedNumber, $denominator-&gt;{units});</div>
<div class="line">                }</div>
<div class="line">                $roundingErrorAnswer *= $numerator;</div>
<div class="line">                $roundingErrorAnswer /= $denominator;</div>
<div class="line">            }</div>
<div class="line">            push @possibleRoundingErrorAnswers, $roundingErrorAnswer;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">            # now grade final answer</span></div>
<div class="line"><span class="preprocessor">            #$finalStudentAnswer = shift @studentArray;</span></div>
<div class="line">            $correctAnswer = pop @correctArray;</div>
<div class="line">            my $result = $correctAnswer-&gt;compareValuesWithUnits(</div>
<div class="line">                $studentAnswer,</div>
<div class="line">                {</div>
<div class="line">                    <span class="stringliteral">&quot;roundingErrorPossibles&quot;</span>=&gt; \@possibleRoundingErrorAnswers,</div>
<div class="line">                    <span class="stringliteral">&quot;penaltyRoundingError&quot;</span>=&gt;0.25,</div>
<div class="line">                    <span class="stringliteral">&quot;creditSigFigs&quot;</span>=&gt;0.25, </div>
<div class="line">                    <span class="stringliteral">&quot;creditValue&quot;</span>=&gt;0.5, </div>
<div class="line">                    <span class="stringliteral">&quot;creditUnits&quot;</span>=&gt;0.25, </div>
<div class="line">                    <span class="stringliteral">&quot;failOnValueWrong&quot;</span>=&gt;1</div>
<div class="line">                });</div>
<div class="line">            my @resultArr = @$result;</div>
<div class="line">    </div>
<div class="line">            push @scores, shift @resultArr;</div>
<div class="line">            my $message = shift @resultArr;</div>
<div class="line">            <span class="keywordflow">if</span> ($message ne <span class="stringliteral">&#39;&#39;</span>){</div>
<div class="line">                $ansHash-&gt;setMessage($count,$message);</div>
<div class="line">            }</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">return</span> \@scores;</div>
<div class="line">        }</div>
<div class="line">    );</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
 
</div>
</div>
<a id="a3e57d264180550c26a099acf017316d9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3e57d264180550c26a099acf017316d9">&#9670;&nbsp;</a></span>asEquality()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method parser::MultiAnswer::asEquality </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Undocumented Method </p>
<div id='codesection-asEquality' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-asEquality-trigger' src='closed.png' alt='open/close icon' style='display:inline'/> <b>Code:</b>
</div>
<div id='codesection-asEquality-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-asEquality-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><div class="line"><span class="preprocessor"># Number of lines of code in asEquality: 140</span></div>
<div class="line">sub <a class="code" href="classparser_1_1MultiAnswer.html#a3e57d264180550c26a099acf017316d9">asEquality</a> {</div>
<div class="line">    my $self = shift;</div>
<div class="line">    my $given = shift;</div>
<div class="line">    my $options = shift;    </div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> $self-&gt;with(</div>
<div class="line">        singleResult =&gt; 0,</div>
<div class="line">        allowBlankAnswers=&gt;1,</div>
<div class="line">        checkTypes =&gt; 0,</div>
<div class="line">        checker =&gt; sub {</div>
<div class="line">            my ($correct,$student,$ansHash) = @_;</div>
<div class="line"> </div>
<div class="line">            my @scores = ();</div>
<div class="line"> </div>
<div class="line">            my @correctArray = @{$correct};</div>
<div class="line">            my @studentArray = @{$student};</div>
<div class="line"> </div>
<div class="line">            unless (scalar @correctArray == 2) {</div>
<div class="line">                Value::Error(<span class="stringliteral">&#39;There should only be two answers in this equality.&#39;</span>);</div>
<div class="line">            }</div>
<div class="line"> </div>
<div class="line">            my $studentCalc = $gradeGiven ? @studentArray[0] : $given;</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">for</span> ($i = 0; $i &lt; 2; $i++){</div>
<div class="line">                <span class="keywordflow">if</span> ($studentArray[$i]-&gt;isExactZero){</div>
<div class="line"><span class="preprocessor">                    # handle if zeros in blanks (assume exact 1 for dimensional analysis)</span></div>
<div class="line"><span class="preprocessor">                    # If we don&#39;t do this, we get division by zero errors.  </span></div>
<div class="line"><span class="preprocessor">                    # Plus, intent of blanks in student dimensional analysis is usually 1 mathmatically.</span></div>
<div class="line"><span class="preprocessor">                    # Final answer doesn&#39;t matter.</span></div>
<div class="line">                    $units = $studentArray[$i]-&gt;{units};</div>
<div class="line">                    $newValue = <a class="code" href="classValue.html">Value</a>-&gt;Package(<span class="stringliteral">&quot;InexactValueWithUnits&quot;</span>)-&gt;new([<span class="charliteral">&#39;1&#39;</span>,9**9**9], $units);</div>
<div class="line">                    $studentArray[$i] = $newValue;</div>
<div class="line">                    </div>
<div class="line">                } elsif ($studentArray[$i]-&gt;isOne) {</div>
<div class="line"><span class="preprocessor">                    # for student conversion factors, assume a 1 is exact!</span></div>
<div class="line">                    $units = $studentArray[$i]-&gt;{units};</div>
<div class="line">                    $newValue = <a class="code" href="classValue.html">Value</a>-&gt;Package(<span class="stringliteral">&quot;InexactValueWithUnits&quot;</span>)-&gt;new([<span class="charliteral">&#39;1&#39;</span>,9**9**9], $units);</div>
<div class="line">                    $studentArray[$i] = $newValue;</div>
<div class="line">                }               </div>
<div class="line">            }</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">            # check both values in equality to see if they must be exact or not.            </span></div>
<div class="line">            $left = $studentArray[0];</div>
<div class="line">            $right = $studentArray[1];</div>
<div class="line"><span class="preprocessor">            # a simple solution would be to look up the units being used and divide their factors... i.e. ft = 0.3048, in = 0.0254</span></div>
<div class="line"><span class="preprocessor">            # so ft/in = 12 exactly</span></div>
<div class="line"><span class="preprocessor">            # now we compare to what the student put.  1 ft / 12 in -&gt; the inverse matches</span></div>
<div class="line"><span class="preprocessor">            # Second example where NOT exact:  L = 0.001  cup = 0.000236588</span></div>
<div class="line"><span class="preprocessor">            # L / cup = 4.22675706291</span></div>
<div class="line"><span class="preprocessor">            # Student might put 1 L / 4.227 cup --- inverse would be 4.227 which is ne to 4.22675706291... so it&#39;s NOT exact</span></div>
<div class="line"><span class="preprocessor">            # Technically, L to cups is never exact.  But if we get precision to this degree, it is probably ok to pretend it is exact.</span></div>
<div class="line"><span class="preprocessor">            # We&#39;re not doing calculations for real-world problems... only education.</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">            # some conversions would have to be manually entered... i.e. lb to g... previous method would require gravity acceleration </span></div>
<div class="line"><span class="preprocessor">            # to be figured into the conversion because they&#39;re technically not the same physical quantities.  Need to compare physical</span></div>
<div class="line"><span class="preprocessor">            # quantities first to see if they could be exact.</span></div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">if</span> (<a class="code" href="classBetterUnits.html#a8f2e082d08b0a8fdd3eba6fb947d3eb1">BetterUnits::comparePhysicalQuantity</a>($left-&gt;{units_ref}, $right-&gt;{units_ref})){</div>
<div class="line">                </div>
<div class="line">                my $studentInverseRatio = $right-&gt;{inexactValue} / $left-&gt;{inexactValue};</div>
<div class="line">                my $ratio = $left-&gt;{units_ref}-&gt;{factor} / $right-&gt;{units_ref}-&gt;{factor};</div>
<div class="line">                $studentInverseRatioAsNumber = $studentInverseRatio-&gt;valueAsNumber();</div>
<div class="line"><span class="preprocessor">                # THIS is really strange, but 1000/1 is not the equal in value to 0.001 / 1e-6 </span></div>
<div class="line"><span class="preprocessor">                # this is equivalent to using the equality 1 L = 1000 mL.</span></div>
<div class="line"><span class="preprocessor">                # To get around this, we covert to string using the &#39;eq&#39; operator.</span></div>
<div class="line">                <span class="keywordflow">if</span> ($ratio eq $studentInverseRatioAsNumber){</div>
<div class="line"><span class="preprocessor">                    # they&#39;re exact!  convert them to values with infinite sig figs</span></div>
<div class="line">                    <span class="keywordflow">if</span> ($left-&gt;sigFigs != 9**9**9){</div>
<div class="line">                        $studentArray[0] = <a class="code" href="classInexactValueWithUnits_1_1InexactValueWithUnits.html">InexactValueWithUnits::InexactValueWithUnits</a>-&gt;<a class="code" href="classInexactValueWithUnits_1_1InexactValueWithUnits.html#a171a08d12134b08d4cad73e9221850a2">new</a>([$left-&gt;valueAsNumber,9**9**9], $left-&gt;{units});</div>
<div class="line">                    }</div>
<div class="line">                    <span class="keywordflow">if</span> ($right-&gt;sigFigs != 9**9**9){</div>
<div class="line">                        $studentArray[1] = <a class="code" href="classInexactValueWithUnits_1_1InexactValueWithUnits.html">InexactValueWithUnits::InexactValueWithUnits</a>-&gt;<a class="code" href="classInexactValueWithUnits_1_1InexactValueWithUnits.html#a171a08d12134b08d4cad73e9221850a2">new</a>([$right-&gt;valueAsNumber,9**9**9], $right-&gt;{units});</div>
<div class="line">                    }</div>
<div class="line">                } </div>
<div class="line">            }</div>
<div class="line">            </div>
<div class="line"><span class="preprocessor">            # Grade equality.  Order does not matter.</span></div>
<div class="line">            my $count=1;</div>
<div class="line">            my $studentGiven;</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">            # What if student supplied inverted equality? i.e. instead of 1 mL = 1e-3 L, they provide 1000 mL = 1 L.</span></div>
<div class="line"><span class="preprocessor">            # We need to make sure the right units are used, BUT instead of comparing individual values, divide numerator and denominator and compare results.</span></div>
<div class="line"><span class="preprocessor">            # Assume 2 values for array.  This is an equality.  Must have both sides filled out.</span></div>
<div class="line">            <span class="keywordflow">if</span> (scalar @studentArray != 2) {</div>
<div class="line">                push @scores, 0;</div>
<div class="line">                push @scores, 0;</div>
<div class="line">                <span class="keywordflow">return</span> \@scores;</div>
<div class="line">            }</div>
<div class="line"> </div>
<div class="line">            $correctRatio = $correctArray[0]-&gt;{inexactValue}/$correctArray[1]-&gt;{inexactValue};</div>
<div class="line">            $studentRatio;</div>
<div class="line">            </div>
<div class="line"><span class="preprocessor">            # Equalities MUST have units.  They are pointless without them.  So only grade if the units are there.</span></div>
<div class="line"><span class="preprocessor">            #if ($studentArray[0]-&gt;{units} eq $correctArray[0]-&gt;{units} &amp;&amp; $studentArray[1]-&gt;{units} eq $correctArray[1]-&gt;{units}) {</span></div>
<div class="line">            <span class="keywordflow">if</span> (<a class="code" href="classInexactValueWithUnits_1_1InexactValueWithUnits.html#ac084cb960b19e412a6e750250cd6016b">InexactValueWithUnits::InexactValueWithUnits::compareUnitHash</a>($studentArray[0]-&gt;{units_ref}, $correctArray[0]-&gt;{units_ref}) == 1</div>
<div class="line">             &amp;&amp; <a class="code" href="classInexactValueWithUnits_1_1InexactValueWithUnits.html#ac084cb960b19e412a6e750250cd6016b">InexactValueWithUnits::InexactValueWithUnits::compareUnitHash</a>($studentArray[1]-&gt;{units_ref}, $correctArray[1]-&gt;{units_ref}) == 1) {</div>
<div class="line">                $studentRatio = $studentArray[0]-&gt;{inexactValue}/$studentArray[1]-&gt;{inexactValue};</div>
<div class="line">                $result = $correctRatio-&gt;compareValue($studentRatio,{<span class="stringliteral">&quot;creditSigFigs&quot;</span>=&gt;0.5, <span class="stringliteral">&quot;creditValue&quot;</span>=&gt;0.5, <span class="stringliteral">&quot;failOnValueWrong&quot;</span>=&gt;1});</div>
<div class="line">                push @scores, $result;</div>
<div class="line">                push @scores, $result;</div>
<div class="line">                <span class="keywordflow">return</span> \@scores;</div>
<div class="line">            } </div>
<div class="line"><span class="preprocessor">#           } elsif ($studentArray[1]-&gt;{units} eq $correctArray[0]-&gt;{units} &amp;&amp; $studentArray[0]-&gt;{units} eq $correctArray[1]-&gt;{units}) {</span></div>
<div class="line">            elsif (<a class="code" href="classInexactValueWithUnits_1_1InexactValueWithUnits.html#ac084cb960b19e412a6e750250cd6016b">InexactValueWithUnits::InexactValueWithUnits::compareUnitHash</a>($studentArray[1]-&gt;{units_ref}, $correctArray[0]-&gt;{units_ref}) == 1</div>
<div class="line">             &amp;&amp; <a class="code" href="classInexactValueWithUnits_1_1InexactValueWithUnits.html#ac084cb960b19e412a6e750250cd6016b">InexactValueWithUnits::InexactValueWithUnits::compareUnitHash</a>($studentArray[0]-&gt;{units_ref}, $correctArray[1]-&gt;{units_ref}) == 1) {</div>
<div class="line">                $studentRatio = $studentArray[1]-&gt;{inexactValue}/$studentArray[0]-&gt;{inexactValue};</div>
<div class="line">                $result = $correctRatio-&gt;compareValue($studentRatio,{<span class="stringliteral">&quot;creditSigFigs&quot;</span>=&gt;0.5, <span class="stringliteral">&quot;creditValue&quot;</span>=&gt;0.5, <span class="stringliteral">&quot;failOnValueWrong&quot;</span>=&gt;1});</div>
<div class="line">                push @scores, $result;</div>
<div class="line">                push @scores, $result;</div>
<div class="line">                <span class="keywordflow">return</span> \@scores;</div>
<div class="line"> </div>
<div class="line">            } <span class="keywordflow">else</span> {</div>
<div class="line">                push @scores, 0;</div>
<div class="line">                push @scores, 0;</div>
<div class="line">                $ansHash-&gt;setMessage(1,<span class="stringliteral">&quot;Without correct units, the equality is incorrect.&quot;</span>);</div>
<div class="line">                <span class="keywordflow">return</span> \@scores;</div>
<div class="line">            }</div>
<div class="line">            </div>
<div class="line"><span class="preprocessor">            #$studentValue = shift @studentArray;</span></div>
<div class="line"><span class="preprocessor">            # # check for matching units on both parts, then check for matching value (with tolerance)</span></div>
<div class="line"><span class="preprocessor">            # for ($i = 0; $i &lt; scalar @studentArray; $i++) {</span></div>
<div class="line"><span class="preprocessor">            #   $score = 0;</span></div>
<div class="line"><span class="preprocessor">            #   for ($j = scalar @correctArray - 1; $j &gt;= 0; $j--) {</span></div>
<div class="line"><span class="preprocessor">            #       if ($studentArray[$i]-&gt;{units} eq $correctArray[$j]-&gt;{units}){</span></div>
<div class="line"><span class="preprocessor">            #           my $correctValue = $correctArray[$j];</span></div>
<div class="line"><span class="preprocessor">            #           $score = $correctValue-&gt;{inexactValue}-&gt;compareValue($studentArray[$i]-&gt;{inexactValue},{&quot;creditSigFigs&quot;=&gt;0.5, &quot;creditValue&quot;=&gt;0.5, &quot;failOnValueWrong&quot;=&gt;1});</span></div>
<div class="line"><span class="preprocessor">            #           if ($score != 0 &amp;&amp; $score != 1){</span></div>
<div class="line"><span class="preprocessor">            #               $ansHash-&gt;setMessage($i+1,&quot;Most likely you have a significant figures problem.&quot;);</span></div>
<div class="line"><span class="preprocessor">            #           }</span></div>
<div class="line"><span class="preprocessor">            #           splice(@correctArray, $j, 1);</span></div>
<div class="line"><span class="preprocessor">            #           #delete $correctArray[$j];</span></div>
<div class="line"><span class="preprocessor">            #           last;</span></div>
<div class="line"><span class="preprocessor">            #       } </span></div>
<div class="line"><span class="preprocessor">            #   }</span></div>
<div class="line"><span class="preprocessor">            #   push @scores, $score;</span></div>
<div class="line"><span class="preprocessor">            # }</span></div>
<div class="line">            <span class="keywordflow">return</span> \@scores;</div>
<div class="line">        }</div>
<div class="line">    );</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
 
</div>
</div>
<a id="a54b4db68ef616645256c1c1cd006a7cc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a54b4db68ef616645256c1c1cd006a7cc">&#9670;&nbsp;</a></span>asPairOfConversionFactors()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method parser::MultiAnswer::asPairOfConversionFactors </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Undocumented Method </p>
<div id='codesection-asPairOfConversionFactors' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-asPairOfConversionFactors-trigger' src='closed.png' alt='open/close icon' style='display:inline'/> <b>Code:</b>
</div>
<div id='codesection-asPairOfConversionFactors-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-asPairOfConversionFactors-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><div class="line"><span class="preprocessor"># Number of lines of code in asPairOfConversionFactors: 127</span></div>
<div class="line">sub <a class="code" href="classparser_1_1MultiAnswer.html#a54b4db68ef616645256c1c1cd006a7cc">asPairOfConversionFactors</a> {</div>
<div class="line">    my $self = shift;</div>
<div class="line">    my $given = shift;</div>
<div class="line">    my $options = shift;    </div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> $self-&gt;with(</div>
<div class="line">        singleResult =&gt; 0,</div>
<div class="line">        allowBlankAnswers=&gt;1,</div>
<div class="line">        checkTypes =&gt; 0,</div>
<div class="line">        checker =&gt; sub {</div>
<div class="line">            my ($correct,$student,$ansHash) = @_;</div>
<div class="line"> </div>
<div class="line">            my @scores = ();</div>
<div class="line"> </div>
<div class="line">            my @correctArray = @{$correct};</div>
<div class="line">            my @studentArray = @{$student};</div>
<div class="line"> </div>
<div class="line">            unless (scalar @correctArray == 4) {</div>
<div class="line">                Value::Error(<span class="stringliteral">&#39;There should only be a pair of conversion factors.  i.e. only 4 answers&#39;</span>);</div>
<div class="line">            }</div>
<div class="line"> </div>
<div class="line">            my $studentCalc = $gradeGiven ? @studentArray[0] : $given;</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">for</span> ($i = 0; $i &lt; 4; $i++){</div>
<div class="line">                <span class="keywordflow">if</span> ($studentArray[$i]-&gt;isExactZero){</div>
<div class="line"><span class="preprocessor">                    # handle if zeros in blanks (assume exact 1 for dimensional analysis)</span></div>
<div class="line"><span class="preprocessor">                    # If we don&#39;t do this, we get division by zero errors.  </span></div>
<div class="line"><span class="preprocessor">                    # Plus, intent of blanks in student dimensional analysis is usually 1 mathmatically.</span></div>
<div class="line"><span class="preprocessor">                    # Final answer doesn&#39;t matter.</span></div>
<div class="line">                    $units = $studentArray[$i]-&gt;{units};</div>
<div class="line">                    $newValue = <a class="code" href="classValue.html">Value</a>-&gt;Package(<span class="stringliteral">&quot;InexactValueWithUnits&quot;</span>)-&gt;new([<span class="charliteral">&#39;1&#39;</span>,9**9**9], $units);</div>
<div class="line">                    $studentArray[$i] = $newValue;</div>
<div class="line">                    </div>
<div class="line">                } elsif ($studentArray[$i]-&gt;isOne) {</div>
<div class="line"><span class="preprocessor">                    # for student conversion factors, assume a 1 is exact!</span></div>
<div class="line">                    $units = $studentArray[$i]-&gt;{units};</div>
<div class="line">                    $newValue = <a class="code" href="classValue.html">Value</a>-&gt;Package(<span class="stringliteral">&quot;InexactValueWithUnits&quot;</span>)-&gt;new([<span class="charliteral">&#39;1&#39;</span>,9**9**9], $units);</div>
<div class="line">                    $studentArray[$i] = $newValue;</div>
<div class="line">                }               </div>
<div class="line">            }</div>
<div class="line">            </div>
<div class="line"><span class="preprocessor">            # check both values in equality to see if they must be exact or not.    </span></div>
<div class="line">            <span class="keywordflow">for</span> ($i = 0; $i &lt; scalar @studentArray; $i+=2) {</div>
<div class="line">                $numerator = $studentArray[$i];</div>
<div class="line">                $denominator = $studentArray[$i+1];     </div>
<div class="line">            </div>
<div class="line"><span class="preprocessor">                # a simple solution would be to look up the units being used and divide their factors... i.e. ft = 0.3048, in = 0.0254</span></div>
<div class="line"><span class="preprocessor">                # so ft/in = 12 exactly</span></div>
<div class="line"><span class="preprocessor">                # now we compare to what the student put.  1 ft / 12 in -&gt; the inverse matches</span></div>
<div class="line"><span class="preprocessor">                # Second example where NOT exact:  L = 0.001  cup = 0.000236588</span></div>
<div class="line"><span class="preprocessor">                # L / cup = 4.22675706291</span></div>
<div class="line"><span class="preprocessor">                # Student might put 1 L / 4.227 cup --- inverse would be 4.227 which is ne to 4.22675706291... so it&#39;s NOT exact</span></div>
<div class="line"><span class="preprocessor">                # Technically, L to cups is never exact.  But if we get precision to this degree, it is probably ok to pretend it is exact.</span></div>
<div class="line"><span class="preprocessor">                # We&#39;re not doing calculations for real-world problems... only education.</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">                # some conversions would have to be manually entered... i.e. lb to g... previous method would require gravity acceleration </span></div>
<div class="line"><span class="preprocessor">                # to be figured into the conversion because they&#39;re technically not the same physical quantities.  Need to compare physical</span></div>
<div class="line"><span class="preprocessor">                # quantities first to see if they could be exact.</span></div>
<div class="line">    </div>
<div class="line">                <span class="keywordflow">if</span> (<a class="code" href="classBetterUnits.html#a8f2e082d08b0a8fdd3eba6fb947d3eb1">BetterUnits::comparePhysicalQuantity</a>($numerator-&gt;{units_ref}, $denominator-&gt;{units_ref})){</div>
<div class="line">                    my $studentInverseRatio = $denominator-&gt;{inexactValue} / $numerator-&gt;{inexactValue};</div>
<div class="line">                    my $ratio = $numerator-&gt;{units_ref}-&gt;{factor} / $denominator-&gt;{units_ref}-&gt;{factor};</div>
<div class="line">                    $studentInverseRatioAsNumber = $studentInverseRatio-&gt;valueAsNumber();</div>
<div class="line"><span class="preprocessor">                    # THIS is really strange, but 1000/1 is not the equal in value to 0.001 / 1e-6 </span></div>
<div class="line"><span class="preprocessor">                    # this is equivalent to using the equality 1 L = 1000 mL.</span></div>
<div class="line"><span class="preprocessor">                    # To get around this, we covert to string using the &#39;eq&#39; operator.</span></div>
<div class="line">                    <span class="keywordflow">if</span> ($ratio eq $studentInverseRatioAsNumber){</div>
<div class="line"><span class="preprocessor">                        # they&#39;re exact!  convert them to values with infinite sig figs</span></div>
<div class="line">                        <span class="keywordflow">if</span> ($numerator-&gt;sigFigs != 9**9**9){</div>
<div class="line"><span class="preprocessor">                            # numerator is exact;</span></div>
<div class="line">                            $studentArray[$i] = <a class="code" href="classInexactValueWithUnits_1_1InexactValueWithUnits.html">InexactValueWithUnits::InexactValueWithUnits</a>-&gt;<a class="code" href="classInexactValueWithUnits_1_1InexactValueWithUnits.html#a171a08d12134b08d4cad73e9221850a2">new</a>([$numerator-&gt;valueAsNumber,9**9**9], $numerator-&gt;{units});</div>
<div class="line">                        }</div>
<div class="line">                        <span class="keywordflow">if</span> ($denominator-&gt;sigFigs != 9**9**9){</div>
<div class="line"><span class="preprocessor">                            # denominator is exact;</span></div>
<div class="line">                            $studentArray[$i+1] = <a class="code" href="classInexactValueWithUnits_1_1InexactValueWithUnits.html">InexactValueWithUnits::InexactValueWithUnits</a>-&gt;<a class="code" href="classInexactValueWithUnits_1_1InexactValueWithUnits.html#a171a08d12134b08d4cad73e9221850a2">new</a>([$denominator-&gt;valueAsNumber,9**9**9], $denominator-&gt;{units});</div>
<div class="line">                        }</div>
<div class="line">                    } </div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">            </div>
<div class="line"><span class="preprocessor">            # Grade equality.  Order does not matter.</span></div>
<div class="line">            my $count=1;</div>
<div class="line">            my $studentGiven;</div>
<div class="line">            </div>
<div class="line"><span class="preprocessor">            #$studentValue = shift @studentArray;</span></div>
<div class="line"><span class="preprocessor">            # check for matching units on both parts, then check for matching value (with tolerance)</span></div>
<div class="line">            <span class="keywordflow">for</span> ($i = 0; $i &lt; scalar @studentArray; $i+=2) {</div>
<div class="line">                $scoreNum = 0;</div>
<div class="line">                $scoreDenom = 0;</div>
<div class="line"><span class="preprocessor">                # maybe student used 1L/1000mL instead of 0.001L/1mL, need to calculate the ratio and see if it matches instead.</span></div>
<div class="line">                $studentRatio = $studentArray[$i]-&gt;{inexactValue}/$studentArray[$i+1]-&gt;{inexactValue};  </div>
<div class="line"><span class="preprocessor">                #needs to go backwards here because we&#39;re deleting items from the array </span></div>
<div class="line">                <span class="keywordflow">for</span> ($j = scalar @correctArray - 2; $j &gt;= 0; $j-=2) {  </div>
<div class="line">                </div>
<div class="line"><span class="preprocessor">#                   if ($studentArray[$i]-&gt;{units} eq $correctArray[$j]-&gt;{units} &amp;&amp; $correctArray[$j+1]-&gt;{units} eq $studentArray[$i+1]-&gt;{units}) {</span></div>
<div class="line">                    <span class="keywordflow">if</span> (<a class="code" href="classInexactValueWithUnits_1_1InexactValueWithUnits.html#ac084cb960b19e412a6e750250cd6016b">InexactValueWithUnits::InexactValueWithUnits::compareUnitHash</a>($studentArray[$i]-&gt;{units_ref}, $correctArray[$j]-&gt;{units_ref}) == 1</div>
<div class="line">                    &amp;&amp; <a class="code" href="classInexactValueWithUnits_1_1InexactValueWithUnits.html#ac084cb960b19e412a6e750250cd6016b">InexactValueWithUnits::InexactValueWithUnits::compareUnitHash</a>($studentArray[$i+1]-&gt;{units_ref}, $correctArray[$j+1]-&gt;{units_ref}) == 1) {</div>
<div class="line">                        $scoreNum = $correctArray[$j]-&gt;{inexactValue}-&gt;compareValue($studentArray[$i]-&gt;{inexactValue},{<span class="stringliteral">&quot;creditSigFigs&quot;</span>=&gt;0.5, <span class="stringliteral">&quot;creditValue&quot;</span>=&gt;0.5, <span class="stringliteral">&quot;failOnValueWrong&quot;</span>=&gt;1});</div>
<div class="line">                        <span class="keywordflow">if</span> ($scoreNum != 0 &amp;&amp; $scoreNum != 1) {</div>
<div class="line">                            $ansHash-&gt;setMessage($i+1,<span class="stringliteral">&quot;Most likely you have a significant figures problem.&quot;</span>);</div>
<div class="line">                        }                       </div>
<div class="line"> </div>
<div class="line">                        $scoreDenom = $correctArray[$j+1]-&gt;{inexactValue}-&gt;compareValue($studentArray[$i+1]-&gt;{inexactValue},{<span class="stringliteral">&quot;creditSigFigs&quot;</span>=&gt;0.5, <span class="stringliteral">&quot;creditValue&quot;</span>=&gt;0.5, <span class="stringliteral">&quot;failOnValueWrong&quot;</span>=&gt;1});</div>
<div class="line">                        <span class="keywordflow">if</span> ($scoreDenom != 0 &amp;&amp; $scoreDenom != 1) {</div>
<div class="line">                            $ansHash-&gt;setMessage($i+1+1,<span class="stringliteral">&quot;Most likely you have a significant figures problem.&quot;</span>);</div>
<div class="line">                        }</div>
<div class="line"> </div>
<div class="line">                        <span class="keywordflow">if</span> ($scoreNum == 0 &amp;&amp; $scoreDenom == 0) {</div>
<div class="line"><span class="preprocessor">                            # check the ratio to see if those match.  Maybe student used a different equality like 1L/1000mL instead of 0.001L/1mL</span></div>
<div class="line">                            $correctRatio = $correctArray[$j]-&gt;{inexactValue}/$correctArray[$j+1]-&gt;{inexactValue}; </div>
<div class="line">                            $result = $correctRatio-&gt;compareValue($studentRatio,{<span class="stringliteral">&quot;creditSigFigs&quot;</span>=&gt;0.5, <span class="stringliteral">&quot;creditValue&quot;</span>=&gt;0.5, <span class="stringliteral">&quot;failOnValueWrong&quot;</span>=&gt;1});</div>
<div class="line">                            $scoreNum = $result;</div>
<div class="line">                            $scoreDenom = $result;  </div>
<div class="line">                        }</div>
<div class="line"> </div>
<div class="line">                        splice(@correctArray, $j, 2);</div>
<div class="line">                        last;</div>
<div class="line">                    }</div>
<div class="line"> </div>
<div class="line">                }</div>
<div class="line">                push @scores, $scoreNum;</div>
<div class="line">                push @scores, $scoreDenom;</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">return</span> \@scores;</div>
<div class="line">        }</div>
<div class="line">    );</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
 
</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li><a class="el" href="parserDimensionalAnalysis_8pl_source.html">parserDimensionalAnalysis.pl</a></li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<div class="ttc" id="aclassValue_html"><div class="ttname"><a href="classValue.html">Value</a></div></div>
<div class="ttc" id="aclassparser_1_1MultiAnswer_html_a54b4db68ef616645256c1c1cd006a7cc"><div class="ttname"><a href="classparser_1_1MultiAnswer.html#a54b4db68ef616645256c1c1cd006a7cc">parser::MultiAnswer::asPairOfConversionFactors</a></div><div class="ttdeci">public method asPairOfConversionFactors()</div></div>
<div class="ttc" id="aclassInexactValueWithUnits_1_1InexactValueWithUnits_html"><div class="ttname"><a href="classInexactValueWithUnits_1_1InexactValueWithUnits.html">InexactValueWithUnits::InexactValueWithUnits</a></div><div class="ttdef"><b>Definition:</b> <a href="contextInexactValueWithUnits_8pl_source.html#l00194">contextInexactValueWithUnits.pl:194</a></div></div>
<div class="ttc" id="aclassparser_1_1MultiAnswer_html_a1774b47961b464851f6b397b56a0d254"><div class="ttname"><a href="classparser_1_1MultiAnswer.html#a1774b47961b464851f6b397b56a0d254">parser::MultiAnswer::asConversionFactor</a></div><div class="ttdeci">public method asConversionFactor()</div></div>
<div class="ttc" id="aclassBetterUnits_html_a8f2e082d08b0a8fdd3eba6fb947d3eb1"><div class="ttname"><a href="classBetterUnits.html#a8f2e082d08b0a8fdd3eba6fb947d3eb1">BetterUnits::comparePhysicalQuantity</a></div><div class="ttdeci">public method comparePhysicalQuantity()</div></div>
<div class="ttc" id="aclassBetterUnits_html_a808c970a36170db2739dcf60a2525fcf"><div class="ttname"><a href="classBetterUnits.html#a808c970a36170db2739dcf60a2525fcf">BetterUnits::isMolarRatio</a></div><div class="ttdeci">public method isMolarRatio()</div></div>
<div class="ttc" id="aclassparser_1_1MultiAnswer_html_acbd2e6f611d469b7648487d6b5aab1f8"><div class="ttname"><a href="classparser_1_1MultiAnswer.html#acbd2e6f611d469b7648487d6b5aab1f8">parser::MultiAnswer::asDimensionalAnalysis</a></div><div class="ttdeci">public method asDimensionalAnalysis()</div></div>
<div class="ttc" id="aclassInexactValueWithUnits_1_1InexactValueWithUnits_html_ac084cb960b19e412a6e750250cd6016b"><div class="ttname"><a href="classInexactValueWithUnits_1_1InexactValueWithUnits.html#ac084cb960b19e412a6e750250cd6016b">InexactValueWithUnits::InexactValueWithUnits::compareUnitHash</a></div><div class="ttdeci">public method compareUnitHash()</div></div>
<div class="ttc" id="aclassInexactValueWithUnits_1_1InexactValueWithUnits_html_a171a08d12134b08d4cad73e9221850a2"><div class="ttname"><a href="classInexactValueWithUnits_1_1InexactValueWithUnits.html#a171a08d12134b08d4cad73e9221850a2">InexactValueWithUnits::InexactValueWithUnits::new</a></div><div class="ttdeci">public method new()</div></div>
<div class="ttc" id="aclassparser_1_1MultiAnswer_html_a3e57d264180550c26a099acf017316d9"><div class="ttname"><a href="classparser_1_1MultiAnswer.html#a3e57d264180550c26a099acf017316d9">parser::MultiAnswer::asEquality</a></div><div class="ttdeci">public method asEquality()</div></div>
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><b>parser</b></li><li class="navelem"><a class="el" href="classparser_1_1MultiAnswer.html">MultiAnswer</a></li>
    <li class="footer">Generated on Wed Aug 2 2023 08:40:32 for WeBWorKChemistry by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
